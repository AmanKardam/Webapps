<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>P2P Chat - Monkeytype Style</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Inter', sans-serif; background-color: #1a1a1a; color: #e2e2e2; }
  .highlight { color: #e2b714; }
  .btn {
    background-color: transparent;
    border: 1px solid #e2b714;
    color: #e2b714;
    padding: 0.4rem 0.8rem;
    border-radius: 6px;
    transition: all 0.2s;
  }
  .btn:hover {
    background-color: #e2b714;
    color: #1a1a1a;
    box-shadow: 0 0 10px #e2b71455;
  }
</style>
</head>
<body class="flex items-center justify-center h-screen">
<div class="w-full max-w-3xl flex flex-col h-full md:h-[90vh]">

  <!-- Header -->
  <header class="p-4 flex justify-between items-center border-b border-gray-700">
    <h1 class="text-xl font-bold highlight">P2P Chat</h1>
    <div class="flex items-center gap-2">
      <span id="my-id" class="font-mono text-sm bg-gray-800 px-2 py-1 rounded">...</span>
      <button id="copy-id" class="btn text-sm">Copy</button>
    </div>
  </header>

  <!-- Chat -->
  <main class="flex-grow flex flex-col p-4 space-y-4 overflow-y-auto" id="chat-messages">
    <div class="text-center italic text-gray-500">Connect with a peer to start chatting.</div>
  </main>

  <!-- Input -->
  <div class="p-4 flex gap-2 border-t border-gray-700">
    <input id="message-input" type="text" placeholder="Type a message..."
      class="flex-grow bg-gray-800 text-gray-200 p-2 rounded focus:outline-none focus:ring-1 focus:ring-[#e2b714] font-mono"/>
    <button id="send-button" class="btn">Send</button>
  </div>

  <!-- Connection -->
  <aside class="p-4 border-t border-gray-700 flex gap-2">
    <input id="peer-id-input" type="text" placeholder="Peer's ID"
      class="flex-grow bg-gray-800 text-gray-200 p-2 rounded focus:outline-none focus:ring-1 focus:ring-[#e2b714] font-mono"/>
    <button id="connect-button" class="btn">Connect</button>
  </aside>

</div>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const myIdEl = document.getElementById('my-id');
  const copyBtn = document.getElementById('copy-id');
  const peerIdInput = document.getElementById('peer-id-input');
  const connectButton = document.getElementById('connect-button');
  const chatMessages = document.getElementById('chat-messages');
  const messageInput = document.getElementById('message-input');
  const sendButton = document.getElementById('send-button');

  let peer, conn;

  function initializePeer() {
    peer = new Peer();
    peer.on('open', id => myIdEl.textContent = id);
    peer.on('connection', newConn => setupConnection(newConn));
    sendButton.disabled = true;
  }

  function setupConnection(newConn) {
    conn = newConn;
    sendButton.disabled = false;
    chatMessages.innerHTML = '';
    conn.on('data', data => addMessage(data, 'peer'));
    conn.on('close', () => {
      sendButton.disabled = true;
      addSystemMessage('Connection closed.');
    });
  }

  function addMessage(msg, sender) {
    const el = document.createElement('div');
    el.className = `max-w-[70%] px-3 py-2 rounded font-mono text-sm ${sender === 'me'
      ? 'ml-auto bg-[#e2b714] text-black'
      : 'mr-auto bg-gray-700 text-gray-200'}`;
    el.textContent = msg;
    chatMessages.appendChild(el);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function addSystemMessage(text) {
    const el = document.createElement('div');
    el.className = 'text-center text-gray-500 italic text-sm';
    el.textContent = text;
    chatMessages.appendChild(el);
  }

  function sendMessage() {
    const msg = messageInput.value.trim();
    if (msg && conn && conn.open) {
      conn.send(msg);
      addMessage(msg, 'me');
      messageInput.value = '';
    }
  }

  sendButton.addEventListener('click', sendMessage);
  messageInput.addEventListener('keypress', e => e.key === 'Enter' && sendMessage());

  connectButton.addEventListener('click', () => {
    const id = peerIdInput.value.trim();
    if (!id) return;
    const newConn = peer.connect(id, { reliable: true });
    setupConnection(newConn);
  });

  copyBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(myIdEl.textContent);
    copyBtn.textContent = 'âœ…';
    setTimeout(() => copyBtn.textContent = 'Copy', 1000);
  });

  initializePeer();
});
</script>
</body>
</html>
